<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Developing Extensions with Backbone.js, Require.js, and Extbase</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">
    <link rel="stylesheet" href="css/custom.css">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section>
          <h1>Welcome</h1>
          <h3>Developing Extensions with Backbone.js, Require.js, and Extbase</h3>
          <p>
            <small>Created by <a href="http://hakim.se">Zach Davis</a> / <a href="http://twitter.com/zdavis">@zdavis</a></small>
          </p>
        </section>
        <section>
          <h2>Who am I?</h2>
          <ul>
            <li>Zach Davis</li>
            <li>Education background (Taught college, English Ph.D.)</li>
            <li>Switched careers about 10 years ago</li>
            <li>Founding partner and developer at Cast Iron Coding</li>
            <li>Spouse, daughter, dog and I live in sunny Portland, OR</li>
          </ul>
        </section>
        <section>
          <h2>Overview</h2>
          <ul>
            <li>Why I think javascript frameworks also make sense on more traditional TYPO3 sites</li>
            <li>Require.js for managing JS dependencies on TYPO3 projects</li>
            <li>A whirlwind tour of Backbone.js as a low-level JS framework</li>
            <li>A look at how we got Extbase to talk to Backbone<br />(this is where it's gonna get a little ugly)</li> 
          </ul>
        </section>
        <section>
          <section>
            <h2>Handling Javascript Resources in TYPO3 is kinda imperfect</h2>
          </section>
          <section>
            <h2>Two main ways to include Javascript</h2>
            <ul>
              <li class="fragment">Include it in the HTML template</li>
              <li class="fragment">Include it via typoscript</li>
            </ul>
          </section>
          <section>
            <h2>Typoscript JS Inclusion</h2>
            <h4>cObj style</h4>
            <pre><code data-trim>
lib.redesign_footerSocialNav {
  wrap = &lt;nav class=&quot;social&quot;&gt;|&lt;/nav&gt;
    10 = TEXT
    100 {
      value (
        &lt;div class=&quot;addthis_toolbox addthis_default_style&quot;&gt;
          &lt;a class=&quot;addthis_button_facebook&quot;&gt;Facebook&lt;/a&gt;
          &lt;a class=&quot;addthis_button_twitter&quot;&gt;Twitter&lt;/a&gt;
          &lt;a class=&quot;addthis_button_linkedin&quot;&gt;Linkedin&lt;/a&gt;
        &lt;/div&gt;
        &lt;script type=&quot;text/javascript&quot; 
        src=&quot;http://s7.addthis.com/js/250/addthis_widget.js&quot;&gt;
        &lt;/script&gt;
    )
  }
}
            </code></pre>
          </section>
          <section>
            <h2>Typoscript JS Inclusion</h2>
            <h4>cObj style take 2</h4>
            <pre><code data-trim>
headerData {
  10 = TEXT
  10.value (
    &lt;script type=&quot;text/javascript&quot; 
      src=&quot;http://use.typekit.com/vnw6eob.js&quot;&gt;&lt;/script&gt;
  )
}            </code></pre>
          </section>
          <section>
            <h2>Typoscript JS Inclusion</h2>
            <h4>header style</h4>
            <pre><code class="json" data-trim>
  # Include modernizr in the header. All other JS is included in the footer.
  includeJS {
    10 = EXT:t3site/Javascript/Libs/modernizr-1.7.min.js
    30 = EXT:t3site/Javascript/Libs/chosen.jquery.min.js
  }

  includeJSLib {
    10 = https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js
    10.external = 1
  }

  includeJSFooter {
    20 = EXT:t3site/Sites/Main/Resources/Public/Javascript/Usr/plugins.js
    30 = EXT:t3site/Sites/Main/Resources/Public/Javascript/Usr/script.js
  }

            </code></pre>
          </section>
          <section>
            <h2>Too many options<br />==<br />a poverty of riches</h2>
            <ul>
              <li class="fragment">PAGE.javascriptLibs</li>
              <li class="fragment">PAGE.includeJSlibs[]</li>
              <li class="fragment">PAGE.includeJSFooterlibs[]</li>
              <li class="fragment">PAGE.includeJS[]</li>
              <li class="fragment">PAGE.includeJSFooter[]</li>
              <li class="fragment">PAGE.jsInline</li>
              <li class="fragment">PAGE.jsFooterInline</li>
              <li class="fragment">PAGE.inlineJS</li>
            </ul>
          </section>
          <section>
            <h2>So many places for things to go wrong</h2>
            <ul>
              <li>All these possibilities make it hard to find where JS is being included</li>
              <li>JS should be managed in JS, not in TS</li>
              <li>Over time, JS dependencies degrade and get messy</li>
              <li>Extensions include javascript too, which often breaks things</li>
              <li>Difficult to create a working asset pipeline out of this</li>
              <li>Really, really slows down JS development to have to include every file</li>
            </ul>
          </section>
          <section>
            <h2>If you use a JS framework, you'll have lots of files...</h2>
            <img src="images/lotsa_files.png" style="height: 350px" />
            <h3>...and you really don't want to manage them manually in Typoscript.</h3>
          </section>
        </section>
        <section>
          <section>
            <h2>Require.js to the rescue!</h2>
            <blockquote style="margin-top: 2em;">
              "RequireJS is a JavaScript file and module loader. It is optimized for in-browser use, but it can be used in other JavaScript environments, like Rhino and Node. Using a modular script loader like RequireJS will improve the speed and quality of your code."
            </blockquote>
            <p style="margin-top: 2em;">
              (And it supports IE6, Firefox 2+, Safari 3.2+, Chrome 3+, Opera 10+)
            </p>
          </section>
          <section>
            <h2>Some warnings</h2>
            <ul>
              <li>Require.js <em>requires</em> that you take care in what javascript is included and how it's included</li>
              <li>If you want to download any TYPO3 extension and have it "just work", this probably isn't for you</li>
              <li>In many cases you'll have to tweak your jQuery plugins to make them work</li>
            </ul>
          </section>
          <section>
            <h2>With require.js, we include the require.js library and reference our javascript manifest*</h2>
            <pre><code class="html">
&lt;script 
  data-main=&quot;typo3conf/ext/t3site/Javascript/Source/Main.js&quot; 
  src=&quot;typo3conf/ext/t3site/Sites/Javascript/Source/Libs/require.js&quot;
&gt;&lt;/script&gt;
            </code></pre>
            <aside>* We're talking about DEV environments now.<br />The include is a bit different in a PROD environment</aside>
          </section>
          <section>
            <h2>Main.js</h2>
            <pre><code class="javacsript">
require.config({
  // We put AMD wrappers around non AMD libraries so 
  // that we can pass them to modules as dependencies
  shim: {
    'underscore': {
      exports: '_'
    },
    'backbone': {
      deps: ['underscore', 'jquery'],
      exports: 'Backbone'
    }
  },
  paths: {
    'backbone': 'Libs/Backbone/backbone',
    'underscore': 'Libs/Underscore/underscore',
    'jquery': 'Libs/JQuery/jquery'
  }
});

require(
  [
    // Triggered by markup, not by a script, so we load it explicitly
    'Libs/Bootstrap/bootstrap-modal',
    'Libs/Bootstrap/bootstrap-collapse',

    // Then load the good stuff
    'Site/Templates',
    'Ext/Cicevents/EventsApp',
    'Ext/Cicregister/Cicregister',
    'Ext/Sjcert/SjApp'
  ]
);

            </code></pre>
            <a href="https://github.com/castiron/Sustainable-Jersey/blob/master/Source/typo3conf/ext/t3site/Sites/Main/Resources/Public/Javascript/Source/Main.js">(view source)</a>
          </section>
          <section>
            <h3>Wrap all JS in define()</h3>
            <pre><code class="javascript">
define({
  color: "black",
  size: "unisize"
});
            </code></pre>
            <h3>Pass in dependencies</h3>
            <pre><code class="javascript">
define(["./cart", "./inventory"], function(cart, inventory) {
  return {
      color: "blue",
      size: "large",
      addToCart: function() {
          inventory.decrement(this);
          cart.add(this);
      }
  }
});
            </code></pre>
          </section>
          <section>
            <h2>What it looks like in practice (switching to coffescript)</h2>
            <pre><code class="coffeescript">
define(['backbone', 'jquery', 'underscore'], (Backbone, $, _) ->

  class MyModelView extends Backbone.View

    initialize: ->
      @.template = $("#template-myModelView").html()

    render: ->
      $(@.el).html(_.template(@.template, {
        action: @.model
      }))
)
            </code></pre>
          </section>
          <section>
            <h2>Require.js loads dependencies asynchronously</h2>
            <img src="images/async_loading.png" style="height: 450px" />
          </section>
          <section>
            <h2>In production, we use optimized javascript</h2>
            <ul>
              <li>Require.js combines all scripts into one and minifies them via UglifyJS</li>
              <li>In production, we have a environment = PROD constant that loads the optimized JS</li>
              <li>Production and dev both have a single line of typoscript for all JS includes</li>
            </ul>
          </section>
        </section>
        <section>
          <h2>Require.js Benefits</h2>
          <ul>
            <li>Easily break up your javascript project into multiple files</li>
            <li>Define dependencies in each file</li>
            <li>Allows for simple dependency injection</li>
            <li>Optimization done via CLI (using node), easy to integrate into build process</li>
            <li>Centralized manifest instead of spread out typoscript includes</li>
          </ul>
        </section>
        <section>
          <section>
            <h2>Backbone!</h2>
            <blockquote>
              "Backbone.js gives structure to web applications by providing models with key-value binding and custom events, collections with a rich API of enumerable functions, views with declarative event handling, and connects it all to your existing API over a RESTful JSON interface."
            </blockquote>
          </section>
          <section>
            <h2>And Underscore!</h2>
            <blockquote>
              "Underscore is a utility-belt library for JavaScript that provides a lot of the functional programming support that you would expect in Prototype.js (or Ruby), but without extending any of the built-in JavaScript objects. It's the tie to go along with jQuery's tux, and Backbone.js's suspenders."
            </blockquote>
          </section>
          <section>
            <h2>Backbone is a frontend MVC framework</h2>
            <ul>
              <li class="fragment">Backbone <strong>TEMPLATES</strong> are like fluid views (but simpler)</li>
              <li class="fragment">Backbone <strong>VIEWS</strong> are what we tend to think as controllers (but not quite)</li>
              <li class="fragment">Backbone <strong>MODELS</strong> tend to be pretty flat data models (unlike, say, Rails models)</li>
              <li class="fragment">Backbone <strong>COLLECTIONS</strong> are a lot like repositories in ExtBase</li>
              <li class="fragment">Backbone <strong>ROUTES</strong> are like routes.rb in Rails (no real equivalent in T3-land)</li>
            </ul>
          </section>
          <section>
              <div style="width: 45%; margin-right: 4%; height: 200px; float: left; border: 1px solid red" data-view="items">
              </div>
              <div style="width: 45%; height: 200px; float: left; border: 1px solid red" data-view="addItem">
              </div>
          </section>
        </section>
      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
